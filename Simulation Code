# Importing packages
import numpy as np
import simpy
from numpy import random



class Nature(object):
    def __init__(self, env, p_spread):
        self.env = env
        self.p_spread = p_spread
        self.resource = simpy.Resource(env, capacity = 1) 
        
    def spread(self, array):
        directions = [(-1, 0), #up
                      (1, 0), #down
                      (0, 1), #right
                      (0, -1)] # left
        
        p = self.p_spread/100
        
        ones_indices = np.argwhere(array == 1)
        
        for x, y in ones_indices:
            
            for dx, dy in directions:
                nx, ny = x + dx, y + dy
                    #nx/ny = coords for neighbouring cells
                    
                if 0 <= nx < array.shape[0] and 0 <= ny < array.shape[1] and array[nx, ny] == 0:
                        #Required parameters, checked for every neighbouring cell
                        
                    if random.random() < p:
                        array[nx, ny] = 1
                    
        return array



def run_spread(env, array, nature):
    while True:
        with nature.resource.request() as request:
            yield request
            
            array = nature.spread(array)
            
            print(f"\nTime {env.now}:")
            print(array)
                #Printing the time value and array at that time
            
            if np.all(array == 1):
                print(f"\nThe map is completely filled after {env.now + 1} units of time")
                return
                    #Checking if the invasive species has completely taken over the environment (array)
            
        yield env.timeout(1)
            
        


def simulate_spread(env, p_spread):
    nature = Nature(env, p_spread)
    
    array = random.randint(1, size = (10,10))
    array[4, 6] = 1
    array[8, 3] = 1
        #Setting coords for the species start location
    
    return run_spread(env, array, nature)





def get_user_input():
    try:
        p_spread = int(input("As a percentage, what is the probability that the invasive species spreads to a neighbouring location? "))
        return p_spread
    except ValueError:
        print("Could not parse input. Using default value (50).")
        return 50
            #Was made using claude ai



def main():
    random.seed(13)
    
    p_spread = get_user_input()
    
    env = simpy.Environment()
    
    env.process(simulate_spread(env, p_spread))
    
    env.run(until = 15)
    

if __name__ == "__main__":
    main()
    